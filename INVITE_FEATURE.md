# Project Invite Feature

## Описание

Добавлена возможность создания invite-ссылок для приглашения пользователей к совместной работе над проектом.

## Функциональность

### Для владельца проекта

1. **Создание invite-ссылки:**
   - На странице проекта нажмите кнопку "Share" в верхней панели
   - Автоматически создастся invite-ссылка со сроком действия 24 часа
   - Скопируйте ссылку и отправьте пользователю, которого хотите пригласить

2. **Доступ к проектам:**
   - Владелец имеет полный доступ ко всем функциям проекта
   - Может создавать invite-ссылки
   - Может удалять проект

### Для приглашенного пользователя

1. **Принятие приглашения:**
   - Перейдите по invite-ссылке
   - Если вы не авторизованы, войдите в систему или создайте аккаунт
   - Нажмите "Accept Invitation" для присоединения к проекту
   - Вы будете перенаправлены на страницу проекта

2. **Доступ к проектам:**
   - Просмотр и редактирование диаграм
   - Создание новых диаграмм
   - Все проекты (собственные и shared) отображаются в Dashboard

## Технические детали

### Backend изменения:

1. **Новые модели:**
   - `ProjectInvite` - хранит информацию о invite-ссылках
   - `project_members` - таблица связи для many-to-many отношений User ↔ Project

2. **Новые API endpoints:**
   - `POST /projects/{project_id}/invite` - создание invite-ссылки
   - `GET /projects/{project_id}/invites` - получение списка активных invite
   - `GET /invite/{token}` - получение информации о invite (без авторизации)
   - `POST /invite/{token}/accept` - принятие приглашения
   - `DELETE /projects/{project_id}/invites/{invite_id}` - деактивация invite

3. **Обновленная логика доступа:**
   - Проверка `is_project_member()` во всех endpoints вместо проверки только `owner_id`
   - Функция `get_user_accessible_projects()` возвращает все доступные проекты (owned + shared)

### Frontend изменения:

1. **Новая страница:**
   - `InvitePage.jsx` - страница для просмотра и принятия приглашений

2. **Обновленные компоненты:**
   - `ProjectPage.jsx` - добавлена кнопка "Share" и модальное окно для invite-ссылок
   - `LoginPage.jsx` - поддержка редиректа после авторизации
   - `RegisterPage.jsx` - поддержка редиректа после регистрации
   - `App.jsx` - добавлен маршрут `/invite/:token`

3. **Новые API методы:**
   - `projectsAPI.createInvite()`
   - `projectsAPI.getInvites()`
   - `projectsAPI.getInviteInfo()`
   - `projectsAPI.acceptInvite()`
   - `projectsAPI.deleteInvite()`

## Безопасность

- Invite-ссылки имеют ограниченный срок действия (24 часа по умолчанию)
- Токены генерируются криптографически безопасным методом (`secrets.token_urlsafe`)
- Только владелец проекта может создавать invite-ссылки
- Проверка прав доступа на всех endpoints

## Примеры использования

### Создание invite-ссылки (API):

```bash
curl -X POST "http://localhost:8000/projects/1/invite" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"expires_in_hours": 24}'
```

### Получение информации о invite:

```bash
curl -X GET "http://localhost:8000/invite/INVITE_TOKEN"
```

### Принятие приглашения:

```bash
curl -X POST "http://localhost:8000/invite/INVITE_TOKEN/accept" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Миграция базы данных

После обновления кода необходимо пересоздать базу данных:

```bash
# Удалить старую базу данных
rm backend/idms.db

# Запустить backend - база данных создастся автоматически
cd backend
python run.py
```

## Известные ограничения

- В текущей версии нет возможности управления правами доступа (все участники имеют одинаковые права)
- Нет возможности удалить пользователя из проекта через UI
- Нет уведомлений о приглашениях

## Будущие улучшения

- Система ролей (viewer, editor, admin)
- Управление участниками проекта через UI
- Email-уведомления о приглашениях
- История приглашений
- Возможность повторной отправки приглашения

