# Backend Refactoring - –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

Backend –±—ã–ª —É—Å–ø–µ—à–Ω–æ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –∏–∑ –ø–ª–æ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Ç–∏–ø–∞–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

### –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¥–æ)
```
backend/
‚îú‚îÄ‚îÄ auth.py           # –í—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ database.py
‚îú‚îÄ‚îÄ models.py         # –í—Å–µ –º–æ–¥–µ–ª–∏ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
‚îú‚îÄ‚îÄ schemas.py        # –í—Å–µ —Å—Ö–µ–º—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
‚îú‚îÄ‚îÄ crud.py           # –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
‚îú‚îÄ‚îÄ main.py           # –í—Å–µ endpoints –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
‚îî‚îÄ‚îÄ run.py
```

### –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ—Å–ª–µ)
```
backend/
‚îú‚îÄ‚îÄ api/              # üÜï API —Ä–æ—É—Ç–µ—Ä—ã (endpoints)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth.py       # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ projects.py   # –ü—Ä–æ–µ–∫—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ diagrams.py   # –î–∏–∞–≥—Ä–∞–º–º—ã –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ invites.py    # –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ core/             # üÜï –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth.py       # JWT, —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ config.py     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ database.py   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ
‚îú‚îÄ‚îÄ crud/             # üÜï CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py       # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ project.py    # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ diagram.py    # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ invite.py     # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏
‚îÇ
‚îú‚îÄ‚îÄ models/           # üÜï –ú–æ–¥–µ–ª–∏ –ë–î (—Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py       # User –º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ project.py    # Project –º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ diagram.py    # Diagram, DiagramElement, DiagramLock
‚îÇ   ‚îî‚îÄ‚îÄ invite.py     # ProjectInvite –º–æ–¥–µ–ª—å
‚îÇ
‚îú‚îÄ‚îÄ schemas/          # üÜï Pydantic —Å—Ö–µ–º—ã (—Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py       # User —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ project.py    # Project —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ diagram.py    # Diagram —Å—Ö–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ invite.py     # Invite —Å—Ö–µ–º—ã
‚îÇ
‚îú‚îÄ‚îÄ main.py           # ‚úèÔ∏è –£–ø—Ä–æ—â–µ–Ω: —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ app –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ run.py            # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ requirements.txt  # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ idms.db          # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 1. üì¶ –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
- –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –∫–æ–¥
- –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### 2. üßπ –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞
- –§–∞–π–ª—ã –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (–±—ã–ª–æ ~300 —Å—Ç—Ä–æ–∫, —Å—Ç–∞–ª–æ ~50-100 —Å—Ç—Ä–æ–∫)
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—É Single Responsibility

### 3. üîß –£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ü—Ä–æ—Å—Ç–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–¥—É
- –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, –≥–¥–µ —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
- –£–¥–æ–±–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ

### 4. üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
- –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ü—Ä–æ—â–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### 5. üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ API endpoints
- –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –≤ –±—É–¥—É—â–µ–º

## –î–µ—Ç–∞–ª–∏ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

### API —Ä–æ—É—Ç–µ—Ä—ã (api/)
**–ë—ã–ª–æ:** –í—Å–µ endpoints –≤ `main.py` (~320 —Å—Ç—Ä–æ–∫)  
**–°—Ç–∞–ª–æ:** –†–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ 4 –º–æ–¥—É–ª—è:
- `auth.py` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `projects.py` - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- `diagrams.py` - —Ä–∞–±–æ—Ç–∞ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
- `invites.py` - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –≤ –ø—Ä–æ–µ–∫—Ç—ã

### Models (models/)
**–ë—ã–ª–æ:** –í—Å–µ –º–æ–¥–µ–ª–∏ –≤ `models.py` (~102 —Å—Ç—Ä–æ–∫–∏)  
**–°—Ç–∞–ª–æ:** –†–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ 4 –º–æ–¥—É–ª—è –ø–æ –¥–æ–º–µ–Ω–Ω—ã–º —Å—É—â–Ω–æ—Å—Ç—è–º:
- `user.py` - User –º–æ–¥–µ–ª—å
- `project.py` - Project –º–æ–¥–µ–ª—å –∏ project_members —Ç–∞–±–ª–∏—Ü–∞
- `diagram.py` - Diagram, DiagramElement, DiagramLock, DiagramType
- `invite.py` - ProjectInvite –º–æ–¥–µ–ª—å

### Schemas (schemas/)
**–ë—ã–ª–æ:** –í—Å–µ —Å—Ö–µ–º—ã –≤ `schemas.py` (~132 —Å—Ç—Ä–æ–∫–∏)  
**–°—Ç–∞–ª–æ:** –†–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ 4 –º–æ–¥—É–ª—è:
- `user.py` - User —Å—Ö–µ–º—ã + Token
- `project.py` - Project —Å—Ö–µ–º—ã
- `diagram.py` - Diagram —Å—Ö–µ–º—ã + —ç–ª–µ–º–µ–Ω—Ç—ã + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- `invite.py` - ProjectInvite —Å—Ö–µ–º—ã

### CRUD (crud/)
**–ë—ã–ª–æ:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ `crud.py` (~256 —Å—Ç—Ä–æ–∫)  
**–°—Ç–∞–ª–æ:** –†–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ 4 –º–æ–¥—É–ª—è:
- `user.py` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `project.py` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- `diagram.py` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏
- `invite.py` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏

### Core (core/)
**–ë—ã–ª–æ:** –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ  
**–°—Ç–∞–ª–æ:** –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ –≤ –ø–∞–ø–∫—É `core/`:
- `config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (settings)
- `database.py` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- `auth.py` - —É—Ç–∏–ª–∏—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- core –º–æ–¥—É–ª–∏: config, database, auth
- models: User, Project, Diagram, ProjectInvite
- schemas: –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- crud: –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- api: –≤—Å–µ —Ä–æ—É—Ç–µ—Ä—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã

### ‚úÖ API endpoints
–í—Å–µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ: **24 –º–∞—Ä—à—Ä—É—Ç–∞**
- Auth endpoints: 3
- Project endpoints: 4
- Diagram endpoints: 9
- Invite endpoints: 5
- Docs endpoints: 3

### ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –º–µ—Å—Ç–µ:
- users
- projects
- project_members
- diagrams
- diagram_elements
- diagram_locks
- project_invites

### ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –Ω–∞ 100%

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!**
- –í—Å–µ API endpoints –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
- Frontend –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏

## –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

1. ‚úÖ API –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–≤—Å–µ endpoints –Ω–∞ —Ç–µ—Ö –∂–µ –ø—É—Ç—è—Ö)
2. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –¥–∞–Ω–Ω—ã–µ)
3. ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt)
4. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (settings)
5. ‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ (run.py)

## –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

```bash
cd backend
python run.py
```

–ò–ª–∏:
```bash
cd backend
uvicorn main:app --reload
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `backend/README.md` - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:8000/docs
- ReDoc –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:8000/redoc

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ Backend —É—Å–ø–µ—à–Ω–æ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω  
‚úÖ –ù–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–Ω–æ  
‚úÖ –ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ  
‚úÖ –ì–æ—Ç–æ–≤ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é

–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º FastAPI –∏ –æ–±–ª–µ–≥—á–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞.

